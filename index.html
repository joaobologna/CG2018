<html>
	<head>
		<title>Projeto CG - Fase 03</title>
		<style>
			body { margin: 0; overflow: 0; }
			canvas { width: 100%; height: 100%; };
		</style>
	</head>
	<body>
		<canvas id="myCanvas"></canvas>
		<script src="js/three.js"></script>
		<script src="js/THREEx.KeyboardState.js"></script>
		
		<script>
			var keyboard = new THREEx.KeyboardState();
			var sideCameraEnabled = true;
			
			init();		
			animate();

			function init() {
				// Renderer
				renderer = create_renderer();
				
				// Camera com visão superior
				upCamera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
				upCamera.position.set(5, 20, -10);
				upCamera.rotation.x = -90 * Math.PI / 180;

				// Camera com visão lateral
				sideCamera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
				sideCamera.position.set(5, 0.6, 12);
			
				// Cena
				scene = new THREE.Scene();

				// Carregar gato, informando escala e posição na tela
				load_obj('json/cat.json', 10, 4, 4, -4, 0, 1.6);

				// Carregar rato, informando escala e posição na tela
				load_obj('json/rat.js', 0.8, 1, 1, 4, 0, 1.6);

				// Carregar faca, informando escala e posição na tela
				load_obj('json/knife.js', 5, 1, 1, 4, 0, 0);

				function create_renderer() {
					var myCanvas = document.getElementById('myCanvas');
			
					renderer = new THREE.WebGLRenderer({
					  canvas: myCanvas, 
					  antialias: true
					});
			
					// Renderer
					renderer.setClearColor(0x000000);
					renderer.setPixelRatio(window.devicePixelRatio);
					renderer.setSize(window.innerWidth, window.innerHeight);
					
					return renderer;				
				}

				function load_obj(path, largura, altura, comprimento, pX, rotationX, rotationY) {
					loader = new THREE.JSONLoader();
					loader.load(path, handle_load);
			
					function handle_load(geometry, materials) {
						materials = new THREE.MeshNormalMaterial();
						mesh = new THREE.Mesh(geometry, materials);
						mesh.scale.set(largura, altura, comprimento); // alteração do tamanho do objeto
						mesh.position.x = pX;
						mesh.rotation.x = rotationX;
						mesh.rotation.y = rotationY;
						scene.position.z = -10;
						scene.add(mesh);
					}
				}		
			}
			
			function animate() {
				requestAnimationFrame(animate);

				if (keyboard.pressed("1"))
					sideCameraEnabled = true;
				if (keyboard.pressed("2"))
					sideCameraEnabled = false;

				render();	
			}

			function render() {
				renderer.clear();

				if (sideCameraEnabled)
					renderer.render(scene, sideCamera);
				else
		  			renderer.render(scene, upCamera); 
			}
		</script>
	</body>
</html>
