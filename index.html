<html>
	<head>
		<title>Projeto CG - Fase 01</title>
		<style>
			body { margin: 0; overflow: 0; }
			canvas { width: 100%; height: 100%; };
		</style>
	</head>
	<body>
		<canvas id="myCanvas"></canvas>
		<script src="js/three.js"></script>
		<script src="js/THREEx.KeyboardState.js"></script>
		
		<script>
			var keyboard = new THREEx.KeyboardState();
			
			init();		
			animate();

			function init() {

				var knifeCameraActive = false;

				// Renderer
				renderer = create_renderer();
				
				// Camera 1
				cameraMouse = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000);
				cameraMouse.position.set(Math.random(),Math.random(),Math.random());

				// Camera 2
				cameraKnife = new THREE.PerspectiveCamera(15, window.innerWidth / window.innerHeight, 0.1, 950);
				cameraKnife.position.set(Math.random(),Math.random(),Math.random());
			
				// Cena
				scene = new THREE.Scene();

				// Carregar gato, informando escala e posição na tela
				load_obj('json/cat.json', 10, 4, 4, -4, 0, 1.4);

				// Carregar rato, informando escala e posição na tela
				load_obj('json/rat.js', 0.8, 1, 1, 4, 0.6, 0.7);

				function create_renderer() {
					var myCanvas = document.getElementById('myCanvas');
			
					renderer = new THREE.WebGLRenderer({
					  canvas: myCanvas, 
					  antialias: true
					});
			
					// Renderer
					renderer.setClearColor(0x000000);
					renderer.setPixelRatio(window.devicePixelRatio);
					renderer.setSize(window.innerWidth, window.innerHeight);
					
					return renderer;				
				}

				function load_obj(path, largura, altura, comprimento, pX, rotationX, rotationY) {
					loader = new THREE.JSONLoader();
					loader.load(path, handle_load);
			
					function handle_load(geometry, materials) {
						materials = new THREE.MeshNormalMaterial();
						mesh = new THREE.Mesh(geometry, materials);
						mesh.scale.set(largura, altura, comprimento); // alteração do tamanho do objeto
						mesh.position.x = pX;
						mesh.rotation.x = rotationX;
						mesh.rotation.y = rotationY;
						scene.add(mesh);
						scene.position.z = -10;
					}
				}		
			}
			
			function animate() {
				requestAnimationFrame(animate);
//				rotation();

			if ( keyboard.pressed("1") )
			{  knifeCameraActive = true;  }
			if ( keyboard.pressed("2") )
			{  knifeCameraActive = false;  }

				render();	
			}

			function render() {


				renderer.clear();

			if (!knifeCameraActive)
			{  renderer.render( scene, cameraKnife );  }
			else
			{
/*	
				var timer = Date.now() * 0.001;
			  cameraMouse.position.x = Math.cos (timer) * 15;
				cameraMouse.position.z = Math.sin (timer) * 15;
				cameraMouse.lookAt(scene.position);
*/
	  		renderer.render( scene, cameraMouse ); 
			}

				
			}
/*
			function rotation() {
				var speed = 0.05;

				if(keyboard.pressed("D")) { mesh.rotation.y += speed; }
				if(keyboard.pressed("A")) { mesh.rotation.y -= speed; }
				if(keyboard.pressed("W")) { mesh.rotation.x += speed; }
				if(keyboard.pressed("S")) { mesh.rotation.x -= speed; }
			}
*/	
		</script>
	</body>
</html>
